{
  "version": 3,
  "file": "recycle.js",
  "sourceRoot": "../..",
  "sources": [
    "src/experiments/recycle.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "\n'use strict'\n\n\n############################################################################################################\nPATH                      = require 'path'\nFS                        = require 'fs'\n#...........................................................................................................\nCND                       = require 'cnd'\nrpr                       = CND.rpr\nbadge                     = 'SCRATCH/CIRCULAR-PIPELINES'\nlog                       = CND.get_logger 'plain',     badge\ninfo                      = CND.get_logger 'info',      badge\nwhisper                   = CND.get_logger 'whisper',   badge\nalert                     = CND.get_logger 'alert',     badge\ndebug                     = CND.get_logger 'debug',     badge\nwarn                      = CND.get_logger 'warn',      badge\nhelp                      = CND.get_logger 'help',      badge\nurge                      = CND.get_logger 'urge',      badge\necho                      = CND.echo.bind CND\n# #...........................................................................................................\n# suspend                   = require 'coffeenode-suspend'\n# step                      = suspend.step\n#...........................................................................................................\n# D                         = require 'pipedreams'\n# $                         = D.remit.bind D\n# $async                    = D.remit_async.bind D\nPS                        = require 'pipestreams'\n{ $, $async, }            = PS\nnew_pushable              = require 'pull-pushable'\nassign                    = Object.assign\njr                        = JSON.stringify\ncopy                      = ( P... ) -> assign {}, P...\nrprx                      = ( d ) -> \"#{d.sigil} #{d.key}:: #{jr d.value ? null} #{jr d.stamped ? false}\"\n\n###\n\n\nPipestream Events v2\n====================\n\nd         := { sigil,          key, value, ... }    # implicit global namespace\n          := { sigil, prefix,  key, value, ... }    # explicit namespace\n\n# `d.sigil` indicates 'regionality':\n\nsigil     := '.' # proper singleton\n          := '~' # system singleton\n          := '(' # start-of-region (SOR)    # '<'\n          := ')' # end-of-region   (EOR)    # '>'\n\n# `prefix` indicates the namespace; where missing on an event or is `null`, `undefined` or `'global'`,\n# it indicates the global namespace:\n\nprefix    := null | undefined | 'global' | non-empty text\n\nkey       := non-empty text         # typename\n\nvalue     := any                    # payload\n\n###\n\n\n#===========================================================================================================\n#\n#-----------------------------------------------------------------------------------------------------------\n@stamp = ( d ) ->\n  ### Set the `stamped` attribute on event to sigil it as processed. Stamped events will not be selected\n  by the `select` method, only by the `select_all` method. ###\n  d.stamped = true\n  return d\n\n\n#===========================================================================================================\n# RECYCLING\n#-----------------------------------------------------------------------------------------------------------\n@unwrap_recycled = ( d ) ->\n  ### Given an event, return its value if its a `~recycle` event; otherwise, return the event itself. ###\n  return if ( @is_recycling d ) then d.value else d\n\n#-----------------------------------------------------------------------------------------------------------\n@$unwrap_recycled = ->\n  return $ ( d, send ) => send @unwrap_recycled d\n\n#-----------------------------------------------------------------------------------------------------------\n@$recycle = ( sender ) ->\n  return PS.$watch ( d ) =>\n    if ( @is_recycling d ) then sender d\n\n\n#===========================================================================================================\n#\n#-----------------------------------------------------------------------------------------------------------\n@select = ( d, prefix, sigils, keys ) ->\n  ### Reject all stamped and recycle events: ###\n  return false if @is_stamped   d\n  return false if @is_recycling d\n  ### TAINT avoid to test twice for arity ###\n  switch arity = arguments.length\n    when 3 then return @select_all d, prefix, sigils ### d, sigils, keys ###\n    when 4 then return @select_all d, prefix, sigils, keys\n    else throw new Error \"expected 3 to 4 arguments, got arity\"\n\n# #-----------------------------------------------------------------------------------------------------------\n# @select_system = ( d, prefix, keys ) ->\n#   ### TAINT avoid to test twice for arity ###\n#   switch arity = arguments.length\n#     when 2 then return @select_all d, prefix, sigils ### d, sigils, keys ###\n#     when 3 then return @select_all d, prefix, sigils, keys\n#     else throw new Error \"expected 3 to 4 arguments, got arity\"\n\n#-----------------------------------------------------------------------------------------------------------\n@select_all = ( d, prefix, sigils, keys ) ->\n  ### accepts 3 or 4 arguments; when 4, then second must be prefix (only one prefix allowed);\n  `sigils` and `keys` may be text or list of texts. ###\n  switch arity = arguments.length\n    # when 2 then [ prefix, sigils, keys, ] = [ null, prefix, sigils, ]\n    when 3 then [ prefix, sigils, keys, ] = [ null, prefix, sigils, ]\n    when 4 then null\n    else throw new Error \"expected 3 to 4 arguments, got arity\"\n  #.........................................................................................................\n  prefix  = null if ( not prefix? ) or ( prefix is 'global' )\n  sigils  ?= null\n  keys  ?= null\n  switch _type = CND.type_of prefix\n    when 'null' then null\n    when 'text' then return false unless d.prefix is prefix\n    else throw new Error \"expected a text or a list, got a #{_type}\"\n  switch _type = CND.type_of sigils\n    when 'null' then null\n    when 'text' then return false unless d.sigil is sigils\n    when 'list' then return false unless d.sigil in sigils\n    else throw new Error \"expected a text or a list, got a #{_type}\"\n  switch _type = CND.type_of keys\n    when 'null' then null\n    when 'text' then return false unless d.key is keys\n    when 'list' then return false unless d.key in keys\n    else throw new Error \"expected a text or a list, got a #{_type}\"\n  return true\n\n\n#===========================================================================================================\n#\n#-----------------------------------------------------------------------------------------------------------\n@is_system = ( d ) ->\n  ### Return whether event is a system event (i.e. whether its `sigil` equals `'~'`). ###\n  return d.sigil is '~'\n\n#-----------------------------------------------------------------------------------------------------------\n@is_recycling = ( d ) ->\n  ### Return whether event is a recycling wrapper event. ###\n  return ( d.sigil is '~' ) and ( d.key is 'recycle' )\n\n#-----------------------------------------------------------------------------------------------------------\n@is_stamped = ( d ) ->\n  ### Return whether event is stamped (i.e. already processed). ###\n  return d.stamped ? false\n\n\n#===========================================================================================================\n#\n#-----------------------------------------------------------------------------------------------------------\n@new_event = ( sigil, key, value, other... ) ->\n  return assign { sigil, key, value, }, other... if value?\n  return assign { sigil, key, }, other...\n\n#-----------------------------------------------------------------------------------------------------------\n@new_single_event   = ( key, value, other...  ) -> @new_event '.', key, value, other...\n@new_start_event    = ( key, value, other...  ) -> @new_event '(', key, value, other...\n@new_stop_event     = ( key, value, other...  ) -> @new_event ')', key, value, other...\n@new_system_event   = ( key, value, other...  ) -> @new_event '~', key, value, other...\n@new_end_event      =                           -> @new_system_event 'end'\n@recycling          = ( d )                     -> @new_system_event 'recycle', d\n\n\n############################################################################################################\nL = @\ndo ->\n  for key, value of L\n    continue unless CND.isa_function value\n    L[ key ] = value.bind L\n  return null\n"
  ]
}