{
  "version": 3,
  "file": "tex-writer-call.js",
  "sourceRoot": "..",
  "sources": [
    "src/tex-writer-call.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "\n'use strict'\n\n############################################################################################################\nPATH                      = require 'path'\n# njs_fs                    = require 'fs'\n#...........................................................................................................\nCND                       = require 'cnd'\nrpr                       = CND.rpr\nbadge                     = 'mkts/tex-writer-call'\nlog                       = CND.get_logger 'plain',     badge\ninfo                      = CND.get_logger 'info',      badge\nwhisper                   = CND.get_logger 'whisper',   badge\nalert                     = CND.get_logger 'alert',     badge\ndebug                     = CND.get_logger 'debug',     badge\nwarn                      = CND.get_logger 'warn',      badge\nhelp                      = CND.get_logger 'help',      badge\nurge                      = CND.get_logger 'urge',      badge\necho                      = CND.echo.bind CND\n#...........................................................................................................\nPIPEDREAMS                = require '../../../pipedreams'\nPS                        = require 'pipestreams'\n{ $, $async, }            = PS\n#...........................................................................................................\nMD_READER                 = require './md-reader'\nhide                      = MD_READER.hide.bind        MD_READER\ncopy                      = MD_READER.copy.bind        MD_READER\nstamp                     = MD_READER.stamp.bind       MD_READER\nselect                    = MD_READER.select.bind      MD_READER\nis_hidden                 = MD_READER.is_hidden.bind   MD_READER\nis_stamped                = MD_READER.is_stamped.bind  MD_READER\n\n\n#-----------------------------------------------------------------------------------------------------------\n@_resolve_arguments = ( S, event ) =>\n  reference_path                      = S.layout_info[ 'source-home' ]\n  [ type, name, parameters, meta, ]   = event\n  [ module_path, method_path, P..., ] = parameters\n  locator                             = PATH.join reference_path, module_path\n  [ crumbs..., method_name, ]         = method_path.split '.'\n  #.....................................................................................................\n  try\n    module  = require locator\n    module  = module[ crumb ] for crumb in crumbs\n  catch error\n    alert '98987-1', \"when trying to resolve #{crumbs.join '.'}\"\n    alert '98987-2', \"starting with module #{rpr locator}\"\n    alert '98987-3', \"an error occurred at path component #{rpr crumb}\"\n    throw error\n  #.....................................................................................................\n  return {\n    type,\n    name,\n    parameters,\n    meta,\n    module_path,\n    method_path,\n    P,\n    method_name,\n    locator,\n    module,\n    crumbs, }\n\n#-----------------------------------------------------------------------------------------------------------\n@$call_await = ( S ) =>\n  ### TAINT implicitly assumes return value will be lines of text ###\n  ### parses MKTS commands of the form `<<!call_await module_path, method_name, parameters... >>` ###\n  # self = @\n  return PIPEDREAMS.$async ( event, send, end ) =>\n    #.......................................................................................................\n    if event? and select event, '!', 'call_await'\n      { module, method_name, P, meta, locator, crumbs, }  = @_resolve_arguments S, event\n      ctx                                                 = { S, event, }\n      #.....................................................................................................\n      try\n        lines   = await module[ method_name ] ctx, P...\n      #.....................................................................................................\n      catch error\n        alert '98987-4', { module, method_name, P, meta, locator, crumbs, }\n        alert '98987-5', \"when trying to call method #{rpr method_name}\"\n        alert '98987-6', \"from module #{rpr locator}##{crumbs.join '.'}\"\n        alert '98987-7', \"with arguments #{rpr P}\"\n        alert '98987-8', \"an error occurred:\"\n        alert '98987-9', error.message\n        throw error\n      #.....................................................................................................\n      for line in lines\n        if CND.isa_text line\n          line = line + '\\n' unless line.endsWith '\\n'\n          send [ '.', 'text', line, ( copy meta ), ]\n        else\n          send line\n      send.done()\n    #.......................................................................................................\n    else\n      send event\n      send.done()\n    #.......................................................................................................\n    end() if end?\n    return null\n\n#-----------------------------------------------------------------------------------------------------------\n@$call_stream = ( S ) =>\n  ### TAINT implicitly assumes return value will be lines of text ###\n  # self = @\n  return PIPEDREAMS.$async ( event, outer_send, outer_end ) =>\n    #.......................................................................................................\n    unless ( event? and select event, '!', 'call_stream' )\n      outer_send event\n      outer_send.done()\n    #.......................................................................................................\n    else\n      { module, method_name, P, meta, locator, crumbs, }  = @_resolve_arguments S, event\n      ctx                                                 = { S, event, }\n      #.....................................................................................................\n      on_stop = PS.new_event_collector 'stop', ->\n        outer_send.done()\n        help \"(finished $call_stream #{method_name})\"\n      #...................................................................................................\n      try\n        source = await module[ method_name ] ctx, P...\n      catch error\n        alert '98987-10', { module, method_name, P, meta, locator, crumbs, }\n        alert '98987-11', \"when trying to call method #{rpr method_name}\"\n        alert '98987-12', \"from module #{rpr locator}##{crumbs.join '.'}\"\n        alert '98987-13', \"with arguments #{rpr P}\"\n        alert '98987-14', \"an error occurred:\"\n        alert '98987-15', error.message\n        throw error\n      #.....................................................................................................\n      pipeline = []\n      pipeline.push source\n      pipeline.push @_$string_as_textline_event S, meta\n      pipeline.push $ ( event, send ) -> outer_send event; send event\n      pipeline.push on_stop.add PS.$drain()\n      PS.pull pipeline...\n    #.......................................................................................................\n    outer_end() if outer_end?\n    return null\n\n#-----------------------------------------------------------------------------------------------------------\n@_$string_as_textline_event = ( S, meta ) ->\n  ### transform strings into text events ###\n  return $ ( line, send ) ->\n    if CND.isa_text line\n      line = line + '\\n' unless line.endsWith '\\n'\n      send [ '.', 'text', line, ( copy meta ), ]\n    else\n      send line\n    return null\n\n"
  ]
}