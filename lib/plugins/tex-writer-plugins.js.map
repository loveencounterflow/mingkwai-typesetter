{
  "version": 3,
  "file": "tex-writer-plugins.js",
  "sourceRoot": "../..",
  "sources": [
    "src/plugins/tex-writer-plugins.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "\n\n\n############################################################################################################\nPATH                      = require 'path'\nFS                        = require 'fs'\n#...........................................................................................................\nCND                       = require 'cnd'\nrpr                       = CND.rpr\nbadge                     = 'MK/TS/TEX-WRITER/PLUGINS'\nlog                       = CND.get_logger 'plain',     badge\ninfo                      = CND.get_logger 'info',      badge\nwhisper                   = CND.get_logger 'whisper',   badge\nalert                     = CND.get_logger 'alert',     badge\ndebug                     = CND.get_logger 'debug',     badge\nwarn                      = CND.get_logger 'warn',      badge\nhelp                      = CND.get_logger 'help',      badge\nurge                      = CND.get_logger 'urge',      badge\necho                      = CND.echo.bind CND\n# #...........................................................................................................\n# suspend                   = require 'coffeenode-suspend'\n# step                      = suspend.step\n#...........................................................................................................\nPIPEDREAMS3B7B            = require 'pipedreams-3b7b'\n# PIPEDREAMS                = require 'pipedreams'\n# PIPEDREAMS.$              = PIPEDREAMS.remit.bind PIPEDREAMS\n# PIPEDREAMS.$async         = PIPEDREAMS.remit_async.bind PIPEDREAMS\n# #...........................................................................................................\n# ASYNC                     = require 'async'\n# #...........................................................................................................\n# ƒ                         = CND.format_number.bind CND\n# HELPERS                   = require '../helpers'\n# TEXLIVEPACKAGEINFO        = require '../texlivepackageinfo'\n# options_route             = '../options.coffee'\n# { CACHE, OPTIONS, }       = require '../options-and-cache'\n# SEMVER                    = require 'semver'\n# #...........................................................................................................\n# XNCHR                     = require '../xnchr'\n# MKTS                      = require '../main'\n# MKTSCRIPT_WRITER          = require '../mktscript-writer'\nMD_READER                 = require '../md-reader'\nhide                      = MD_READER.hide.bind        MD_READER\ncopy                      = MD_READER.copy.bind        MD_READER\nstamp                     = MD_READER.stamp.bind       MD_READER\nunstamp                   = MD_READER.unstamp.bind     MD_READER\nselect                    = MD_READER.select.bind      MD_READER\nis_hidden                 = MD_READER.is_hidden.bind   MD_READER\nis_stamped                = MD_READER.is_stamped.bind  MD_READER\n# MACRO_ESCAPER             = require '../macro-escaper'\n# MACRO_INTERPRETER         = require '../macro-interpreter'\n# LINEBREAKER               = require '../linebreaker'\n# @COLUMNS                  = require '../tex-writer-columns'\n# @MKTS_TABLE               = require '../tex-writer-mkts-table'\n# AUX                       = require '../tex-writer-aux'\n# YADDA                     = require '../yadda'\nOVAL                      = require '../object-validator'\n# UNITS                     = require '../mkts-table-units'\n#...........................................................................................................\n# Σ_formatted_warning       = Symbol 'formatted-warning'\npromisify                 = ( require 'util' ).promisify\njr                        = JSON.stringify\nnew_pushable              = require 'pull-pushable'\nPS                        = require 'pipestreams'\n# { $, $async, }            = PS\n### TAINT temporary kludge ###\nfinished_sym              = Symbol.for 'finished'\n\n#-----------------------------------------------------------------------------------------------------------\n@_resolve_arguments = ( S, Q ) =>\n  reference_path                      = S.layout_info[ 'source-home' ]\n  #.....................................................................................................\n  if ( match = Q.src.match /// ^ (?<module_path> .+? ) \\# (?<method_path> [^\\#]+ ) $ /// )?\n    { module_path, method_path, } = match.groups\n    method_path                   = null if method_path is ''\n  #.....................................................................................................\n  else\n    module_path = Q.src\n    method_path = 'main'\n  #.....................................................................................................\n  crumbs  = if method_path? then method_path.split '.' else null\n  locator = PATH.join reference_path, module_path\n  #.....................................................................................................\n  try\n    module    = require locator\n    reference = module\n    callable  = module\n    if crumbs?\n      for crumb in crumbs\n        reference = callable\n        callable  = callable[ crumb ]\n    throw new Error \"not callable: #{rpr method_path}\" unless CND.isa_function callable\n    callable = callable.bind reference\n  catch error\n    alert '98987-1', \"when trying to resolve #{rpr Q.src}\"\n    alert '98987-2', \"starting with module #{rpr locator}\"\n    alert '98987-3', \"an error occurred\"\n    throw error\n  #.....................................................................................................\n  return Object.assign {}, Q, { locator, module_path, method_path, callable, }\n\n#-----------------------------------------------------------------------------------------------------------\nnew_sync_sub_sender = ( transforms ) ->\n  ### Given a transform, construct a pipeline with a pushable as its source, and\n  return a function that accepts a data event to be processed by the pipeline. ###\n  # The sub-sender works by temporarily attaching a hidden ###\n  pushable  = new_pushable()\n  collector = []\n  pipeline  = []\n  callback  = null\n  pipeline.push pushable\n  pipeline.push PS.$ ( d, send ) -> send d; send [ '~', finished_sym, ]\n  pipeline.push transform for transform in transforms\n  pipeline.push PS.$ ( d, send ) ->\n    if select d, '~', finished_sym\n      send collector\n      collector = []\n    else\n      collector.push d\n  pipeline.push PS.$watch ( d ) -> callback d\n  pipeline.push PS.$drain()\n  PS.pull pipeline...\n  return ( d, send ) -> callback = send; pushable.push d\n\n#-----------------------------------------------------------------------------------------------------------\n@$plugins = ( S ) =>\n  self    = @$plugins\n  schema  =\n    postprocess: ( Q ) =>\n      throw new Error \"µ38893 expected non-empty text, got #{jr Q}\" unless Q.src.length     > 0\n      throw new Error \"µ38894 expected non-empty text, got #{jr Q}\" unless Q.prefix.length  > 0\n      throw new Error \"µ38895 unable to redefine prefix #{rpr Q.prefix}\" if self.known_prefixes.has Q.prefix\n      self.known_prefixes.add Q.prefix\n      return @_resolve_arguments S, Q\n    #.......................................................................................................\n    properties:\n      src:        { type: 'string', }\n      prefix:     { type: 'string', }\n    #.......................................................................................................\n    additionalProperties: false\n    required:             [ 'src', 'prefix', ]\n  #.........................................................................................................\n  validate_and_cast = OVAL.new_validator schema\n  #.........................................................................................................\n  return PIPEDREAMS3B7B.$async ( event, send, done ) =>\n    if select event, '.', 'plugin'\n      [ type, name, Q, meta, ]  = event\n      Q                         = validate_and_cast Q\n      self.callables.push [ Q.callable, { prefix: Q.prefix, }, ]\n      send stamp event\n      done()\n      #.....................................................................................................\n      ### TAINT shouldn't build a new pipeline for each event ###\n      plugins               = ( ( callable S, settings ) for [ callable, settings, ] in self.callables )\n      self.send_to_plugins  = new_sync_sub_sender plugins\n    #.......................................................................................................\n    else if self.callables.length > 0\n      self.send_to_plugins event, ( events ) -> send event for event in events; done()\n    #.......................................................................................................\n    else\n      send event\n      done()\n    #.......................................................................................................\n    return null\n@$plugins.callables           = []\n@$plugins.known_prefixes      = new Set()\n@$plugins.send_to_plugins     = null\n\n\n"
  ]
}