{
  "version": 3,
  "file": "tex-writer-mkts-table.js",
  "sourceRoot": "..",
  "sources": [
    "src/tex-writer-mkts-table.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "\n\n\n'use strict'\n\n############################################################################################################\nCND                       = require 'cnd'\nrpr                       = CND.rpr\nbadge                     = 'MKTS/TEX-WRITER/MKTSTABLE'\nlog                       = CND.get_logger 'plain',     badge\ninfo                      = CND.get_logger 'info',      badge\nwhisper                   = CND.get_logger 'whisper',   badge\nalert                     = CND.get_logger 'alert',     badge\ndebug                     = CND.get_logger 'debug',     badge\nwarn                      = CND.get_logger 'warn',      badge\nhelp                      = CND.get_logger 'help',      badge\nurge                      = CND.get_logger 'urge',      badge\necho                      = CND.echo.bind CND\n#...........................................................................................................\nD                         = require 'pipedreams'\n$                         = D.remit.bind D\n$async                    = D.remit_async.bind D\n#...........................................................................................................\nECS                       = require './eval-cs'\nMKTS                      = require './main'\nMD_READER                 = require './md-reader'\nhide                      = MD_READER.hide.bind        MD_READER\ncopy                      = MD_READER.copy.bind        MD_READER\nstamp                     = MD_READER.stamp.bind       MD_READER\nunstamp                   = MD_READER.unstamp.bind     MD_READER\nselect                    = MD_READER.select.bind      MD_READER\nis_hidden                 = MD_READER.is_hidden.bind   MD_READER\nis_stamped                = MD_READER.is_stamped.bind  MD_READER\njr                        = JSON.stringify\n#...........................................................................................................\nMKTS_TABLE                = require './mkts-table'\nMKTS.MACRO_ESCAPER.register_raw_tag 'mkts-table-description'\n\n\n#===========================================================================================================\n#\n#-----------------------------------------------------------------------------------------------------------\n@$main = ( S ) ->\n  #.........................................................................................................\n  return D.TEE.from_pipeline [\n    @$parse_description               S\n    @$render_description              S\n    # @$dump_table_description          S\n    ]\n\n#===========================================================================================================\n#\n#-----------------------------------------------------------------------------------------------------------\n@$dump_table_description = ( S ) -> D.$observe ( event ) ->\n  return unless select event, '.', 'MKTS/TABLE/description', true\n  help '99871', ( CND.blue rpr event[ 2 ] )\n\n#-----------------------------------------------------------------------------------------------------------\n@$parse_description = ( S ) ->\n  within_mkts_table = false\n  return $ ( event, send ) =>\n    #.......................................................................................................\n    if select event, '.', 'mkts-table-description'\n      [ type, name, text, meta, ] = event\n      [ description, sandbox, ]   = @get_mkts_table_description_and_sandbox S, event\n      try\n        ECS.evaluate text, { language: 'coffee', sandbox, }\n      catch error\n        warn \"when trying to evaluate CS source text for <mkts-table> (source line ##{meta.line_nr}),\"\n        warn \"an error occurred\"\n        throw error\n      send stamp event\n      send [ '.', 'MKTS/TABLE/description', description, ( copy meta ), ]\n    #.......................................................................................................\n    else\n      send event\n    #.......................................................................................................\n    return null\n\n#-----------------------------------------------------------------------------------------------------------\n@$render_description = ( S ) ->\n  ### TAINT should allow to name tables in description and content tags ###\n  prv_description       = null\n  within_table_content  = false\n  within_field           = false\n  fields                 = {}\n  current_field          = null\n  #.........................................................................................................\n  return $ ( event, send ) =>\n    if select event, '.', 'MKTS/TABLE/description'\n      [ type, name, description, meta, ]  = event\n      prv_description                     = description\n      return send stamp event\n    #.......................................................................................................\n    if select event, '(', 'mkts-table-content'\n      within_table_content = true\n      return send stamp event\n    #.......................................................................................................\n    if select event, ')', 'mkts-table-content'\n      within_table_content = false\n      # send sub_event for sub_event from MKTS_TABLE._walk_events description\n      ### TAINT render table now ###\n      debug '66522', fields\n      return send stamp event\n    #.......................................................................................................\n    if within_table_content\n      #.....................................................................................................\n      if select event, '(', 'field'\n        within_field = true\n        [ type, name, Q, meta, ]  = event\n        if not Q? and Q.key?\n          throw new Error \"need key for field\"\n        ### TAINT must validate key at some point; like this, content with an unknown key will just vanish ###\n        current_field = fields[ Q.key ] = []\n        return send stamp event\n      #.....................................................................................................\n      if select event, ')', 'field'\n        within_field   = false\n        current_field  = null\n        return send stamp event\n      #.....................................................................................................\n      if within_field\n        current_field.push event\n        urge '27762', jr event\n        return send stamp event\n      #.....................................................................................................\n      if ( select event, '.', 'text' ) and ( event[ 2 ].match /^\\s*$/ )?\n        whisper '27762', jr event\n        return send stamp event\n      #.....................................................................................................\n      # throw new Error \"detected illegal content: #{rpr event}\"\n      warn '27762', jr event\n      return\n    #.......................................................................................................\n    send event\n    #.......................................................................................................\n    return null\n\n#-----------------------------------------------------------------------------------------------------------\n@get_mkts_table_description_and_sandbox = ( S, event ) ->\n  ### This method makes the format-defining names of the MKTS Table Formatter available at the top level,\n  curried so that the current context (`me`) that contains the processed details as defined so far as well\n  as data on the general typesetting context. All names are templating functions, such that each may be\n  called as `grid'4x4'`, `merge'[a1]..[a4]'` and so on from the source within the MKTS document where the\n  table is being defined. ###\n  me      = MKTS_TABLE._new_description S\n  me.meta = event[ 3 ]\n  ### ... more typesetting detail attached here ... ###\n  #.........................................................................................................\n  f = ->\n    @debug            = ( raw_parts ) -> MKTS_TABLE.debug           me, raw_parts.join ''\n    @gridwidth        = ( raw_parts ) -> MKTS_TABLE.gridwidth       me, raw_parts.join ''\n    @gridheight       = ( raw_parts ) -> MKTS_TABLE.gridheight      me, raw_parts.join ''\n    @paddingwidth     = ( raw_parts ) -> MKTS_TABLE.paddingwidth    me, raw_parts.join ''\n    @paddingheight    = ( raw_parts ) -> MKTS_TABLE.paddingheight   me, raw_parts.join ''\n    @marginwidth      = ( raw_parts ) -> MKTS_TABLE.marginwidth     me, raw_parts.join ''\n    @marginheight     = ( raw_parts ) -> MKTS_TABLE.marginheight    me, raw_parts.join ''\n    @unitwidth        = ( raw_parts ) -> MKTS_TABLE.unitwidth       me, raw_parts.join ''\n    @unitheight       = ( raw_parts ) -> MKTS_TABLE.unitheight      me, raw_parts.join ''\n    @cellwidths       = ( raw_parts ) -> MKTS_TABLE.cellwidths      me, raw_parts.join ''\n    @cellheights      = ( raw_parts ) -> MKTS_TABLE.cellheights     me, raw_parts.join ''\n    @fieldcells       = ( raw_parts ) -> MKTS_TABLE.fieldcells      me, raw_parts.join ''\n    @fieldborder      = ( raw_parts ) -> MKTS_TABLE.fieldborder     me, raw_parts.join ''\n    return @\n  #.........................................................................................................\n  return [ me, ( f.apply {} ), ]\n\n\n\n"
  ]
}