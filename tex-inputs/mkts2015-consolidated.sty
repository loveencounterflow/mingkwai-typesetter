


% ==========================================================================================================
% Unicode and CJK Handling
% ----------------------------------------------------------------------------------------------------------
% ftp://ftp.tu-chemnitz.de/pub/tex/macros/latex/contrib/nag/nag.pdf
\RequirePackage[l2tabu, orthodox]{nag}

\usepackage{fontspec}
% \usepackage{/home/flow/own/tex-packages/xeCJK-2.4.6-r306/xeCJK}
% \usepackage{xeCJK}

% % Should fix CJK linebreaks as per http://tex.stackexchange.com/a/38276/28067
% % ### TAINT this setting should be made only available inside CJK text regions ###
% \XeTeXlinebreaklocale "ja"% for Japanese
% \XeTeXlinebreakskip 0pt plus 0.1pt% sets the skip

\usepackage{leading}
\usepackage{etextools}
\usepackage{array}
\usepackage{relsize}\renewcommand\RSlargest{100mm}\renewcommand\RSsmallest{0.1mm}
\usepackage{ragged2e}
\usepackage{needspace}
\usepackage[user]{zref}
% \usepackage{/Volumes/Storage/io/jizura-xelatex/tex-inputs/utils}
% \usepackage{/Users/flow/JIZURA/flow/dictionary/tex-inputs/accentbx/accentbx}
\usepackage{cxltx-style-accentbox}
\usepackage{cxltx-style-trm}
% \usepackage{longtable}
% \usepackage{pbox}
% \let\footruleskip\undefined\usepackage{fancyhdr}

% Package fixltx2e Warning: fixltx2e is not required with releases after 2015
% (fixltx2e)                All fixes are now in the LaTeX kernel.
% (fixltx2e)                See the latexrelease package for details.
% \usepackage{fixltx2e}

% \usepackage[usenames,dvipsnames,svgnames,table,x11names]{xcolor}
\usepackage[factor=1000]{microtype}
\usepackage{cxltx-style-base}
\usepackage{cxltx-style-trm}
% \usepackage{cxltx-style-accentbox}
\usepackage{cxltx-style-pushraise}
\usepackage{cxltx-style-hyphenation-tolerance}
\usepackage{cxltx-style-oddeven}
\usepackage{cxltx-style-position-absolute}
\usepackage{cxltx-style-pushraise}
\usepackage{cxltx-style-transform}
\usepackage{cxltx-style-smashbox}

% ### TAINT to be replaced with something else ###
% \usepackage{cxltx-style-cjkglue}
\newcommand{\cjkgUseCjkGlue}{}
\newcommand{\cjkgGlue}{}
\newcommand{\cjkgKeepLines}{}


% \usepackage[null]{mkts-base} % plain
% \usepackage[null]{mkts-endnotes}
% % \usepackage[null]{mkts-page-geometry} % a4
% \usepackage[null]{mkts-headers-and-footers} % jizura
% \usepackage[null]{mkts-fontsets}
% \usepackage[null]{mkts-styles}
% \usepackage[null]{mkts-para-font-size} % plain
% \usepackage[null]{mkts-headings-and-toc}

\usepackage[plain]{mkts-base}%                  plain
\usepackage[default]{mkts-endnotes}%            default
% \usepackage[a4,cmgrid]{mkts-page-geometry}
\usepackage[a4,linebands]{mkts-page-geometry}
% \usepackage[a4,ascenders,baselines,descenders]{mkts-page-geometry}
% \usepackage[a4,ascenders,descenders,baselines,columns]{mkts-page-geometry}
% \usepackage[a4,baselines,columns]{mkts-page-geometry}
\usepackage[a4]{mkts-page-geometry}%            a4
\usepackage[jizura]{mkts-headers-and-footers}%  jizura
\usepackage[default]{mkts-fontsets}%            default
\usepackage[default]{mkts-styles}%              default
\usepackage[plain]{mkts-para-font-size}%        plain
\usepackage[default]{mkts-headings-and-toc}%    default



\newcommand{\mktsJzrVerticalbarInfix}{}%
\newcommand{\mktsJzrVerticalbarGlyph}{}%

  % ........................................................................................................
  \renewcommand{\mktsJzrVerticalbarInfix}{%
    {\color{red}\hspace{0.2em}\makebox(0,0){\rule[0.5em]{0.15mm}{1.25em}}\hspace{0.2em}}%
    % {\color{red}\hspace{0.2em}\rule[-0.4em]{0.15mm}{1.4em}\hspace{0.1em}}%
    % {\color{red}\rule[-0.4em]{0.15mm}{1.4em}}%
    }
  % ........................................................................................................
  \renewcommand{\mktsJzrVerticalbarGlyph}{%
    % {\color{black}\hspace{0.2em}\rule[-0.4em]{0.15mm}{1.4em}\hspace{0.1em}}%
    }

\newcommand{\mktsJzrGlyphbraceLeft}{%
  {%
    \mktsFontfileSourcehansansheavy%
    \color{red}%
    \makebox[0mm]{「}%
    }%
  }

\newcommand{\mktsJzrGlyphbraceRight}{%
  {%
    \mktsFontfileSourcehansansheavy%
    \color{red}%
    \makebox[0mm]{」}%
    }%
  }

\newcommand{\mktsJzrGlyphdivider}{%
  {%
    \mktsFontfileHanamina%
    % \color{red}%
    % {\makebox(0,0){\rule[0em]{0.1mm}{1em}}}%
    \mktsScaleFont{0.2}%
    {\tfRaise{+0.85}\makebox(0,0){▼}}%
    {\tfRaise{-0.35}\makebox(0,0){▲}}%
    }%
  }

\newenvironment{mktsEnvBlockquote}{%
  \par%
  \mktsStyleItalic%
  \setlength{\leftskip}{1em}%
  \setlength{\rightskip}{1em}%
  \ignorespaces}{%
  \par%
  }


% ==========================================================================================================
%
% 8888888888  .d88888b.  888b    888 88888888888  .d8888b.
% 888        d88P" "Y88b 8888b   888     888     d88P  Y88b
% 888        888     888 88888b  888     888     Y88b.
% 8888888    888     888 888Y88b 888     888      "Y888b.
% 888        888     888 888 Y88b888     888         "Y88b.
% 888        888     888 888  Y88888     888           "888
% 888        Y88b. .d88P 888   Y8888     888     Y88b  d88P
% 888         "Y88888P"  888    Y888     888      "Y8888P"
%
% ==========================================================================================================
%


% ==========================================================================================================
% 2) Display Styles
% ----------------------------------------------------------------------------------------------------------
\newcommand{\adjustCjkIdeograph}[1]{\prRaise{-0.125}{#1}} % !!!
% \newcommand{\adjustJzrCjkIdeograph}[1]{\prRaise{-0.125}{#1}} % !!!
\newcommand{\adjustJzrCjkIdeograph}[1]{\prRaise{-0.125}{\makebox[1.1053\mktsFontsize]{#1}}} % !!!

% ..........................................................................................................
\newcommand{\latin}[1]{{\mktsFontfileEbgaramondtwelveregular#1}}
% \newcommand{\setPlainLatin}{\renewcommand{\latin}[1]{{\mktsFontfileEbgaramondtwelveregular#1}}}
% \newcommand{\setCodeLatin}{\renewcommand{\latin}[1]{{\mktsFontfileSunexta#1}}}
\newcommand{\py}{\mktsScaleFont{0.8}\mktsFontfileUbuntur{}}
\newcommand{\ncr}[1]{{\mktsFontfileUbuntur#1}}
\newcommand{\gloss}[1]{{\mktsFontfileEbgaramondtwelveregular#1}}
% ..........................................................................................................
% \XeTeXlinebreaklocale "ja"% for Japanese
% \XeTeXlinebreakskip 0pt plus 0.1pt% sets the skip
% }
\renewcommand{\cjkgGlue}{\hskip 0mm plus 0.7mm minus 0.0mm}
% \renewcommand{\cjkgGlue}{{\makebox[0mm]{\color{red}|}}\hskip 0mm plus 0.7mm minus 0.0mm}
\newcommand{\cjk}{%
  % \cjkgUseCjkGlue%
  \mktsStyleFontCjkDefault%
  }
% \newcommand{\cn}{\mktsStartCjk\mktsFontfileSunexta}
\newcommand{\cn}{%
  \cjkgGlue%
  \mktsScaleFontRelative{1.1}%
  % \mktsStyleFontCjkDefault%
  % \tfRaise{-0.175}%
  % \aftergroup\cjkgGlue%
  % ### TAINT measurements might not scale with font sizes; we might use precalculated factors ###
  \special{pdf:literal 1 0 0 1 0 -2 cm}%
  \AfterGroup{\special{pdf:literal 1 0 0 1 0 2 cm}\cjkgGlue}%
  % \AfterGroup{\cjkgGlue}%
  }
\newcommand{\mktsRsgFb}{\mktsFontfileSunexta}
\newcommand{\cnxa}{\mktsFontfileSunexta}
\newcommand{\cnxb}{\mktsFontfileSunflowerucjkxb}
\newcommand{\cnxc}{\mktsFontfileHanaminb}
\newcommand{\cnxd}{\mktsFontfileBabelstonehan}
\newcommand{\cncone}{\mktsFontfileSunexta}       % CJK Compatibility 1
\newcommand{\cnctwo}{\mktsFontfileHanamina}          % CJK Compatibility 2
\newcommand{\cnrone}{\mktsFontfileSunexta}       % CJK Radicals 1
\newcommand{\cnrtwo}{\mktsFontfileSunexta}       % CJK Radicals 2
\newcommand{\cnsym}{\mktsFontfileHanamina}
\newcommand{\cnstrk}{\mktsFontfileSunexta}
% ..........................................................................................................
\newcommand{\cnxBabel}{\mktsFontfileBabelstonehan}
\newcommand{\cnxHanaA}{\mktsFontfileHanamina}
\newcommand{\cnxHanaB}{\mktsFontfileHanaminb}
\newcommand{\cnxSunXA}{\mktsFontfileSunexta}
% ..........................................................................................................
\newcommand{\cnjzr}{%
  % \cn%
  \mktsFontfileJizurathreeb%
  % \mktsScaleFont{1.1}
  }%
\newcommand{\cnxJzr}{\cnjzr}
% \newcommand{\missing}[1]{{\missingFont#1}}
% ..........................................................................................................
% ### TAINT scaling given here is only for readings, not for ordinary mixed text ###
\newcommand{\ka}{%
  \special{pdf:literal 1 0 0 1 0 0.5 cm}%
  \mktsFontfileIpamp%
  \mktsScaleFont{0.96}%
  \AfterGroup{\special{pdf:literal 1 0 0 1 0 -0.5 cm}}%
  }
\newcommand{\hi}{%
  \special{pdf:literal 1 0 0 1 0 0.5 cm}%
  \mktsFontfileIpamp%
  \mktsScaleFont{1.0185}%
  \AfterGroup{\special{pdf:literal 1 0 0 1 0 -0.5 cm}}%
  }

% \newcommand{\xxxFoo}{0.75}
% \pgfmathsetmacro{\xxxBar}{0.9 * \xxxFoo}
% \pgfmathsetmacro{\xxxBaz}{0.5 * 3}
  % \mktsScaleFont{\xxxBar}%

\newcommand{\hg}{%
  \special{pdf:literal 1 0 0 1 0 0.5 cm}%
  \mktsFontfileNanummyeongjo%
  \mktsScaleFont{0.9}%
  \AfterGroup{\special{pdf:literal 1 0 0 1 0 -0.5 cm}}%
  }
% ..........................................................................................................
\newcommand{\jzrStrokeclassZZWBF}{\prPushRaise{-0.1}{-0.1}{{\mktsFontfileJizurathreeb{}}}}
\newcommand{\jzrStrokeclassOne}{\prPushRaise{-0.1}{-0.1}{{\mktsFontfileJizurathreeb{}}}}
\newcommand{\jzrStrokeclassTwo}{\prPushRaise{-0.1}{-0.1}{{\mktsFontfileJizurathreeb{}}}}
\newcommand{\jzrStrokeclassThree}{\prPushRaise{-0.1}{-0.1}{{\mktsFontfileJizurathreeb{}}}}
\newcommand{\jzrStrokeclassFour}{\prPushRaise{-0.1}{-0.15}{{\mktsFontfileJizurathreeb{}}}}
\newcommand{\jzrStrokeclassFive}{\prPushRaise{-0.1}{-0.1}{{\mktsFontfileJizurathreeb{}}}}
\newcommand{\jzrStrokeclassLeftHook}{\prPushRaise{-0.1}{-0.1}{{\mktsFontfileJizurathreeb{}}}}
\newcommand{\jzrStrokeclassRightHook}{\prPushRaise{-0.1}{-0.1}{{\mktsFontfileJizurathreeb{}}}}
% ..........................................................................................................
\newcommand{\jzrStrokeclassTextZZWBF}{\prPushRaise{0}{-0.15}{{\mktsFontfileJizurathreeb{}}}}
\newcommand{\jzrStrokeclassTextOne}{\prPushRaise{0}{-0.15}{{\mktsFontfileJizurathreeb{}}}}
\newcommand{\jzrStrokeclassTextTwo}{\prPushRaise{0}{-0.15}{{\mktsFontfileJizurathreeb{}}}}
\newcommand{\jzrStrokeclassTextTwoHook}{\prPushRaise{0}{-0.15}{{\mktsFontfileJizurathreeb{}}}}
\newcommand{\jzrStrokeclassTextThree}{\prPushRaise{0}{-0.15}{{\mktsFontfileJizurathreeb{}}}}
\newcommand{\jzrStrokeclassTextFour}{\prPushRaise{0}{-0.15}{{\mktsFontfileJizurathreeb{}}}}
\newcommand{\jzrStrokeclassTextFourSlant}{\prPushRaise{0}{-0.15}{{\mktsFontfileJizurathreeb{}}}}
\newcommand{\jzrStrokeclassTextFive}{\prPushRaise{0}{-0.15}{{\mktsFontfileJizurathreeb{}}}}
\newcommand{\jzrStrokeclassTextLeftHook}{\prPushRaise{0}{-0.15}{{\mktsFontfileJizurathreeb{}}}}
\newcommand{\jzrStrokeclassTextRightHook}{\prPushRaise{0}{-0.15}{{\mktsFontfileJizurathreeb{}}}}
% ..........................................................................................................
\newcommand{\kai}{\renewcommand{\mktsStyleFontCjkDefault}{\mktsFontfileBiaukai}}
\newcommand{\jzrkai}[1]{{\mktsFontfileJizurathreeb{}#1}}
% ..........................................................................................................
\newcommand{\pageNr}[1]{{\fontsize{2.5mm}{2.5mm}\mktsFontfilePtsans#1}}
% \newcommand{\sfncr}[1]{{\fontsize{2mm}{2mm}\jzrFontInputMonoCompressedLight#1}}
\newcommand{\wbf}[1]{{\fontsize{2mm}{2mm}\jzrFontInputMonoCompressedMedium#1}}
\newcommand{\pageNrText}[1]{{\fontsize{3mm}{5mm}\mktsFontfilePtsans#1}}
\newcommand{\wbfText}[1]{{\fontsize{3mm}{5mm}\jzrFontInputMonoCompressedMedium#1}}







